jQuery(function(l){l.fn.csp_scripts=function(){l(this).sw_select2(),l(this).find(".woocommerce-help-tip, .help_tip, .tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})};var i=l("#restrictions_data"),c=i.find(".bulk_toggle_wrapper"),r=i.find(".wc-metaboxes"),e=r.find(".woocommerce_restrictions__boarding"),t=i.find(".toolbar"),s=r.find(".woocommerce_restriction").length;function a(e,t){"yes"===t.val()?(t.val("no"),e.removeClass("woocommerce-input-toggle--enabled").addClass("woocommerce-input-toggle--disabled")):(t.val("yes"),e.removeClass("woocommerce-input-toggle--disabled").addClass("woocommerce-input-toggle--enabled"))}""===wc_restrictions_admin_params.post_id?(i.closest("table.form-table").removeClass("form-table").addClass("restrictions-form-table"),l(".wccsp-delete-restriction-rule").on("click",function(){return window.confirm(wc_restrictions_admin_params.i18n_delete_rule_warning)}),l(".column-wc_actions a").on("mousedown",function(){l(this).triggerHandler("mouseleave")}),i.on("click",".wc-metabox > h3",function(){l(this).parent(".wc-metabox").toggleClass("closed").toggleClass("open"),l(this).next(".wc-metabox-content").stop().slideToggle(300)}),i.sw_select2(),l(".wc-metabox",i).each(function(){var e=l(this),t=e.find(".wc-metabox-content");e.hasClass("closed")&&t.hide()})):i.sw_select2(),i.on("click",".wc-metabox > h3",function(e){e.target.id}).on("click","#active-toggle",function(){var t=l(this),o=t.closest(".wc-metabox").find(".wc-metabox-content > input.enabled"),e=t.closest(".woocommerce_restriction"),n=e.data("restriction_id"),i=e.data("index");if(-1<e[0].className.indexOf("woocommerce_restriction--added"))return a(t,o),!1;t.addClass("woocommerce-input-toggle--loading");var c={action:"woocommerce_toggle_restriction",value:o.val(),post_id:wc_restrictions_admin_params.post_id,hash:r.attr("data-hash"),index:i,restriction_id:n,security:wc_restrictions_admin_params.toggle_restriction_nonce};return l.ajax({url:wc_restrictions_admin_params.wc_ajax_url,data:c,method:"POST",dataType:"json",complete:function(){t.removeClass("woocommerce-input-toggle--loading")},success:function(e){0<e.errors.length?window.alert(e.errors.join("\n\n")):(a(t,o),r.attr("data-hash",e.hash))},error:function(){window.alert(wc_restrictions_admin_params.i18n_toggle_session_expired)}}),!1}).on("click",".remove_row",function(e){var t=l(this).closest(".wc-metabox");t.find("*").off(),t.remove(),d(),e.preventDefault()}),i.on("keyup","input.short_description",function(){l(this).closest(".woocommerce_restriction").find("h3 .restriction_title_inner").text(l(this).val())}).on("click",".expand_all",function(){return r.find(".wc-metabox").each(function(){var e=l(this);e.find(".wc-metabox-content").show(),e.addClass("open").removeClass("closed")}),!1}).on("click",".close_all",function(){return r.find(".wc-metabox").each(function(){var e=l(this);e.find(".wc-metabox-content").hide(),e.addClass("closed").removeClass("open")}),!1}).on("change","select.csp_shipping_countries",function(){var e,o,t=l(this),n=(e=t.selectSW("data"),o=[],l.each(e,function(e,t){o.push({key:t.id,value:t.text})}),o),i=t.closest(".condition_content, .woocommerce_restriction_form").find("select.csp_shipping_states"),c=i.find(":selected"),r=[],s=wc_restrictions_admin_params.shipping_states_data,a=[];c.each(function(){r.push(l(this).val())}),l.each(n,function(e,t){var n=[],i=t.key,c=t.value,o=s[i]||!1;if(!o)return!0;l.each(o,function(e,t){var o=i+":"+e;n.push({id:o,text:c+" â€” "+t,selected:-1!==l.inArray(o,r)})}),a.push({text:c,children:n})}),i.children().remove(),i.selectSW({data:a})}).on("click",".wccsp_select_all",function(){var e=l(this).closest(".select-field");return e.find("select option").prop("selected","selected"),e.find("select").trigger("change"),!1}).on("click",".wccsp_select_none",function(){var e=l(this).closest(".select-field");return e.find("select option").removeAttr("selected"),e.find("select").trigger("change"),!1}).on("click","button.add_restriction",function(){var e=l("select.restriction_type",i).val(),t=r.find(".woocommerce_restriction_"+e),o=r.find(".woocommerce_restriction");if(""===e)return!1;i.block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var n={action:"woocommerce_add_checkout_restriction",post_id:wc_restrictions_admin_params.post_id,index:s,restriction_id:e,applied_count:t.length,count:o.length,security:wc_restrictions_admin_params.add_restriction_nonce};return s++,setTimeout(function(){l.post(wc_restrictions_admin_params.wc_ajax_url,n,function(e){var t;0<e.errors.length?window.alert(e.errors.join("\n\n")):(i.trigger("woocommerce_before_restriction_add",e),r.append(e.markup),(t=r.find(".woocommerce_restriction").last()).csp_scripts(),t.data("conditions_count",0),c.removeClass("disabled")),i.unblock(),i.trigger("woocommerce_restriction_added",e)},"json")},250),!1}).on("woocommerce_before_restriction_add",function(){e.length&&(e.hide(),t.removeClass("restriction_data--empty"))}).on("change","input.show_excluded_in_checkout",function(){var e=l(this),t=e.is(":checked"),o=e.closest(".woocommerce_restriction_data").find(".show-excluded-checked");t?o.show():o.hide()});var o,_={},n={};function m(e,t){var o=!1;return"object"==typeof n[e]&&"function"==typeof n[e][t]?o=n[e][t]:(o=wp.template("wc_csp_restriction_"+e+"_condition_"+t+"_content"),void 0===n[e]&&(n[e]={}),n[e][t]=o),o}function d(){var o=!1;r.find(".woocommerce_restriction").each(function(e,t){l(".position",t).val(e),l(".restriction_title_index",t).html(e+1),o=!0}),o?c.removeClass("disabled"):c.addClass("disabled")}r.find(".woocommerce_restriction").each(function(){var e=l(this).find(".restriction_conditions .condition_row").length;l(this).data("conditions_count",e)}),i.on("mousedown",".condition_remove .trash",function(){l(this).triggerHandler("mouseleave")}).on("click",".condition_remove .trash",function(e){return e.preventDefault(),l(this).closest(".condition_row").remove(),!0}).on("change",".condition_add select.condition_type",function(){var e=l(this),t=e.val();if("add_condition"===t)return!1;var o=e.closest(".woocommerce_restriction"),n=o.data("restriction_id"),i=parseInt(o.data("index")),c=parseInt(o.data("conditions_count")),r=function(e){var t=!1;"function"==typeof _[e]?t=_[e]:(t=wp.template("wc_csp_restriction_"+e+"_condition_row"),_[e]=t);return t}(n),s=m(n,t);if(!r||!s)return!1;var a=r({condition_index:c,condition_content:s({restriction_index:i,condition_index:c})});o.data("conditions_count",c+1),o.find(".restriction_conditions_list").append(a);var d=o.find(".restriction_conditions_list .condition_row").last();return d.find('.condition_type option[value="'+t+'"]').prop("selected","selected"),d.csp_scripts(),e.find('option[value="add_condition"]').prop("selected","selected"),!1}).on("change",".restriction_conditions_list select.condition_type",function(){var e=l(this),t=e.val(),o=e.closest(".woocommerce_restriction"),n=o.data("restriction_id"),i=parseInt(o.data("index")),c=e.closest(".condition_row"),r=parseInt(c.data("condition_index")),s=m(n,t);if(!s)return!1;var a=s({restriction_index:i,condition_index:r});c.find(".condition_content").html(a).addClass("added");var d=c.find(".added");return d.csp_scripts(),d.removeClass("added"),!1}),(o=r.find(".woocommerce_restriction").get()).sort(function(e,t){var o=parseInt(l(e).attr("data-index")),n=parseInt(l(t).attr("data-index"));return o<n?-1:n<o?1:0}),l(o).each(function(e,t){r.append(t)}),d(),r.sortable({items:".woocommerce_restriction",cursor:"move",axis:"y",handle:".sort-item",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style"),d()}})});